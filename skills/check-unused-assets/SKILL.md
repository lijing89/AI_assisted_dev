---
name: check-unused-assets
description: 检查项目中指定目录下的未使用的资源文件。在用户需要清理资源、检查资源引用或优化包体积时调用。
---

# 资源引用检查器 (Asset Usage Checker)

此技能用于扫描项目中指定目录下的资源文件，并检查它们是否在代码中被引用。旨在帮助开发者发现未使用的资源，减小包体积。

## 核心功能

1.  **指定目录扫描**：支持用户指定要检查的资源目录（默认为 `resources`）。
2.  **智能引用匹配**：
    *   **静态引用**：检查文件名是否直接出现在代码中。
    *   **动态引用启发式检查**：对于常见的动态加载模式（如 `icon_$name.png`），尝试匹配文件名的关键部分（如 `name`）。
    *   **命名规则豁免**：允许通过配置或规则忽略特定命名模式的文件（例如以 `lw_` 开头的 Spine 动画资源）。
3.  **安全模式**：
    *   **只读不删**：仅输出检查结果，**绝不**自动删除任何文件。
    *   **风险提示**：对于疑似未使用但无法确定的文件，标记为“疑似未使用”并提示人工确认。

## 使用流程

1.  **确定范围**：询问用户要检查的资源目录（如 `resources/images`）和代码目录（如 `lib`）。
2.  **执行扫描**：
    *   遍历资源目录收集所有文件。
    *   遍历代码目录读取所有源码内容。
3.  **分析引用**：
    *   如果完整文件名（如 `bg_login.png`）在代码中存在 -> **已使用**。
    *   如果完整文件名不存在，但文件位于已知动态加载目录（如 `gift_spine`） -> **跳过/标记为动态资源**。
    *   如果完整文件名不存在 -> **标记为未使用**。
4.  **输出报告**：
    *   列出未使用的文件路径和大小。
    *   统计节省的潜在体积。

## 示例

**用户输入**：
"检查 resources/images 目录下未使用的图片"

**执行逻辑**：
1.  扫描 `resources/images` 下的所有图片。
2.  在 `lib/` 和 `pubspec.yaml` 中查找文件名。
3.  输出结果。

**输出示例**：
```
[检查报告]
扫描目录: resources/images
----------------------------------------
[疑似未使用] resources/images/old_banner.png (500KB)
[疑似未使用] resources/images/test_icon.jpg (20KB)
----------------------------------------
共发现 2 个疑似未使用文件，总大小: 520KB
注意: 请在删除前进行人工二次确认，防止动态引用误删。
```
